2025-05-11 12:58:50,079 - generate_label_data_task - ERROR - TaskID: 47bbe528-8e93-4710-a478-c6442fc43492 - InputID: constant_id_17 - Message: Error in generate_label_data_main: expected str, bytes or os.PathLike object, not NoneType
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 363, in generate_label_data_main
    os.makedirs(voice_personality_dir, exist_ok=True)
  File "D:\python310\lib\os.py", line 210, in makedirs
    head, tail = path.split(name)
  File "D:\python310\lib\ntpath.py", line 185, in split
    p = os.fspath(p)
TypeError: expected str, bytes or os.PathLike object, not NoneType
2025-05-11 13:00:42,062 - generate_label_data_task - ERROR - TaskID: 30ab5913-604e-4b58-bb1d-b0a798db03b2 - InputID: constant_id_17 - Message: Error in generate_label_data_main: expected str, bytes or os.PathLike object, not NoneType
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 363, in generate_label_data_main
    os.makedirs(voice_personality_dir, exist_ok=True)
  File "D:\python310\lib\os.py", line 210, in makedirs
    head, tail = path.split(name)
  File "D:\python310\lib\ntpath.py", line 185, in split
    p = os.fspath(p)
TypeError: expected str, bytes or os.PathLike object, not NoneType
2025-05-11 13:22:51,480 - generate_label_data_task - ERROR - TaskID: 7f748c19-5f7d-4b87-a0b2-d47eb6a49078 - InputID: constant_id_17 - Message: Error in generate_label_data_main: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 338, in generate_label_data_main
    input_files_paths, grand_text_input = save_text_chunk(input_data, input_id, text_input_data_dir)
ValueError: too many values to unpack (expected 2)
2025-05-11 13:27:32,131 - generate_label_data_task - ERROR - TaskID: 3a0115c7-a857-41dd-ae52-c7643991ec0d - InputID: constant_id_17 - Message: Error in generate_label_data_main: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 338, in generate_label_data_main
    input_files_paths, grand_text_input = save_text_chunk(input_data, input_id, text_input_data_dir)
ValueError: too many values to unpack (expected 2)
2025-05-11 13:29:27,598 - generate_label_data_task - ERROR - TaskID: e08caae9-eb75-4a8c-b814-2e1c3e55269f - InputID: constant_id_17 - Message: Error in generate_label_data_main: too many values to unpack (expected 2)
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 340, in generate_label_data_main
    input_files_paths, grand_text_input = save_text_chunk(input_data, input_id, text_input_data_dir)
ValueError: too many values to unpack (expected 2)
2025-05-11 13:34:49,689 - generate_label_data_task - ERROR - TaskID: 14751e30-3b9f-4182-9a32-2a27396239d8 - InputID: constant_id_17 - Message: Error in generate_label_data_main: expected str, bytes or os.PathLike object, not NoneType
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 367, in generate_label_data_main
    os.makedirs(voice_personality_dir, exist_ok=True)
  File "D:\python310\lib\os.py", line 210, in makedirs
    head, tail = path.split(name)
  File "D:\python310\lib\ntpath.py", line 185, in split
    p = os.fspath(p)
TypeError: expected str, bytes or os.PathLike object, not NoneType
2025-05-11 13:38:28,123 - generate_label_data_task - ERROR - TaskID: 2f9b8198-6a14-4764-9c9a-6e1f980f6ef5 - InputID: constant_id_17 - Message: Error in generate_label_data_main: expected str, bytes or os.PathLike object, not NoneType
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 371, in generate_label_data_main
    os.makedirs(voice_personality_dir, exist_ok=True)
  File "D:\python310\lib\os.py", line 210, in makedirs
    head, tail = path.split(name)
  File "D:\python310\lib\ntpath.py", line 185, in split
    p = os.fspath(p)
TypeError: expected str, bytes or os.PathLike object, not NoneType
2025-05-11 13:46:34,201 - generate_label_data_task - ERROR - TaskID: 691192ab-f431-4bd4-9112-74e733c60c92 - InputID: constant_id_17 - Message: Error in generate_label_data_main: cannot unpack non-iterable NoneType object
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 77, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 382, in generate_label_data_main
    break_outer, last_memory_file_dir = process_files_in_folder(input_files_paths, output_dir, memory_dir, gemini_key, input_id)
TypeError: cannot unpack non-iterable NoneType object
2025-05-15 01:34:31,272 - generate_label_data_task - ERROR - TaskID: e1155769-44a7-4124-b5fd-955414960b1a - InputID: 88eb50a6-29d7-4593-bee2-935b9fa23f92 - Message: Error in generate_label_data_main: '<=' not supported between instances of 'int' and 'str'
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 397, in generate_label_data_main
    process_all_label_text_files(sentence_transformer_model, output_dir, memory_dir) # bước chuẩn hoá output tên nhân vật
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\text_output_verification\data_label_fixer.py", line 156, in process_all_label_text_files
    output_content = process_texts(memory_content, output_content, model)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\text_output_verification\data_label_fixer.py", line 35, in process_texts
    if chunk_index - 3 <= last_appearance <= chunk_index + 3:
TypeError: '<=' not supported between instances of 'int' and 'str'
2025-05-15 10:56:15,346 - generate_label_data_task - ERROR - TaskID: 196b1b41-64e3-4ebd-914d-b7d4de15c85c - InputID: 7dc1c157-3364-47a9-b42c-e29d25240efd - Message: Error in generate_label_data_main: '<=' not supported between instances of 'int' and 'str'
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 397, in generate_label_data_main
    process_all_label_text_files(sentence_transformer_model, output_dir, memory_dir) # bước chuẩn hoá output tên nhân vật
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\text_output_verification\data_label_fixer.py", line 156, in process_all_label_text_files
    output_content = process_texts(last_memory_content, output_content, model)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\text_output_verification\data_label_fixer.py", line 35, in process_texts
    if chunk_index - 3 <= last_appearance <= chunk_index + 3:
TypeError: '<=' not supported between instances of 'int' and 'str'
2025-05-16 12:49:15,485 - generate_label_data_task - ERROR - TaskID: d2e1e2c7-1d8f-4813-b1a1-f503e7de2951 - InputID: 8ad454fd-9c1f-496b-9d7f-195f33aa948b - Message: Error in generate_label_data_main: 'characters'
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 413, in generate_label_data_main
    character_names_in_last_context_memory_list = extract_character_names(find_largest_suffix_file(memory_dir))
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\other_service\service.py", line 491, in extract_character_names
    for character, details in data["characters"].items():
KeyError: 'characters'
2025-05-16 12:55:30,104 - generate_label_data_task - ERROR - TaskID: 475524ba-fa35-4b50-9800-0b563f90771f - InputID: 767c371b-7611-4efe-9d8c-a7ef0728c9e3 - Message: Error in generate_label_data_main: 'characters'
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 413, in generate_label_data_main
    character_names_in_last_context_memory_list = extract_character_names(find_largest_suffix_file(memory_dir))
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\other_service\service.py", line 491, in extract_character_names
    except json.JSONDecodeError:
KeyError: 'characters'
2025-05-16 13:11:17,731 - generate_label_data_task - ERROR - TaskID: edfc0b91-489b-49be-b372-cf80a4d97a04 - InputID: 99a990ec-319e-41cd-bd51-a6187950a402 - Message: Error in generate_label_data_main: 'characters'
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 421, in generate_label_data_main
    character_prompts_answer, un_finished_flag = create_character_analysis_prompts(grand_text_input,output_dir,unique_characters_dict,last_memory_file_dir,len(input_files_paths),character_personality_output_dir,gemini_key) #sinh bộ nhân cách và các thông tin khác của nhân vật từ dict trên tại character_personality_output_dir
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\extract_character_personality\extract_character_personality.py", line 141, in create_character_analysis_prompts
    for character, details in context_memory['characters'].items():
KeyError: 'characters'
2025-05-18 18:16:14,999 - generate_label_data_task - ERROR - TaskID: 34b8904e-b180-4817-a6b5-7d89fcd16842 - InputID: 9634b5a4-299c-4d16-9d26-7b6613ef8b58 - Message: Error in generate_label_data_main: Weights sum to zero, can't be normalized
Traceback (most recent call last):
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\app.py", line 89, in run_label_data_task
    result_dirs = generate_label_data_main(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\generate_label_data.py", line 438, in generate_label_data_main
    personality_mapper_main(validate_identity_character_personality_output_dir,voice_personality_dir,voice_personality_by_lore_dir, sentence_transformer_model,character_voice_mapper_dir) #tạo ra bộ điểm tương đồng giữa nhân vật trong story và các voice actor (top 10) (output nằm trong personality_mapper_data)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\character_voice_mapper.py", line 249, in personality_mapper_main
    return find_n_most_similar_in_group_b(characters_a,characters_b,sentence_transformer_model,output_path,age_weight,OCEAN_weight,trait_weight,n)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\character_voice_mapper.py", line 112, in find_n_most_similar_in_group_b
    similarity = calculate_similarity(
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\character_voice_mapper.py", line 60, in calculate_similarity
    traits1 = get_character_embedding(char1_data, model)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\src\character_voice_mapper.py", line 27, in get_character_embedding
    weighted_embedding = np.average(trait_embeddings, axis=0, weights=trait_weights)
  File "D:\FINAL_CODE\backend\ai_service\service\narrative-annotation-service\venv\lib\site-packages\numpy\lib\_function_base_impl.py", line 565, in average
    raise ZeroDivisionError(
ZeroDivisionError: Weights sum to zero, can't be normalized
